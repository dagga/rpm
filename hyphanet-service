#!/bin/bash

# Hardcoded paths to avoid sed in spec file
INSTALL_PATH="/opt/hyphanet"
DATA_PATH="/var/lib/hyphanet"

WRAPPER_CMD="${INSTALL_PATH}/hyphanet-wrapper"
CONF_FILE="${INSTALL_PATH}/wrapper.conf"
PID_FILE="${DATA_PATH}/hyphanet.pid"

# Ensure wrapper is executable
if [ ! -x "$WRAPPER_CMD" ]; then
    chmod +x "$WRAPPER_CMD"
fi

case "$1" in
    'start')
        exec "$WRAPPER_CMD" -c "$CONF_FILE" wrapper.pidfile="$PID_FILE" wrapper.daemonize=TRUE
        ;;
    'console')
        exec "$WRAPPER_CMD" -c "$CONF_FILE" wrapper.pidfile="$PID_FILE" wrapper.daemonize=FALSE
        ;;
    *)
        echo "Usage: $0 {start|console}"
        exit 1
        ;;
esac